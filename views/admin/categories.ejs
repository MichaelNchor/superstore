<%- include("../admin/topbar") %>

<div class="container-fluid" style="background: #f8fafc; min-height: 100vh; padding: 2rem 0;">   
    <div class="row px-xl-5 pb-3">  
                    
      <div class="col-sm-12">
      <div class="admin-header-modern" style="background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <h2 style="color: white; margin: 0; font-size: 1.75rem; font-weight: 600; display: flex; align-items: center;">
              <i class="fas fa-folder-open" style="margin-right: 0.75rem;"></i>
              Categories Management
            </h2>
            <p style="color: rgba(255,255,255,0.9); margin: 0.5rem 0 0 0; font-size: 0.95rem;">Organize your products into categories</p>
          </div>
          <a class="btn-modern btn-modern-primary" href="/admin/categories/add-category" style="background: white; color: #2563eb;">
            <i class="fas fa-plus"></i>
            Add Category
          </a>
        </div>
      </div>

      <%- include('../messages/adminMessages') %>

      <div style="background: white; border-radius: 12px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); overflow: hidden;">      
        <table class="table-modern-admin sorting">
          <thead>
              <tr class="home">
                  <th scope="col">
                    <i class="fas fa-tag" style="margin-right: 0.5rem; color: #8b5cf6;"></i>
                    Category
                  </th>
                  <th scope="col">
                    <i class="fas fa-image" style="margin-right: 0.5rem; color: #8b5cf6;"></i>
                    Image
                  </th>
                  <th scope="col">
                    <i class="fas fa-box" style="margin-right: 0.5rem; color: #8b5cf6;"></i>
                    Products
                  </th>
                  <th scope="col" style="text-align: center;">Actions</th>
              </tr>
          </thead>
          <tbody>
              <% categories.forEach(function(category){ %>
              <tr scope="row" id="id_<%= category._id %>" class="<%= category.slug %>" style="cursor: move;">
                  <td style="font-weight: 500; color: #1e293b;"><%= category.title %></td>
                  <td>
                      <% if (category.image == "") { %>
                      <img id="noimage" src="/images/noimage.png" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb;">
                      <% } else { %>
                      <img id="noimage" src="/category_images/<%= category._id %>/<%= category.image %>" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb;">
                      <% } %>
                  </td>
                  <td class="text-left align-middle">
                    <span class="badge-modern-info" style="background: #dbeafe; color: #1e40af; padding: 0.35rem 0.75rem; border-radius: 6px; font-weight: 600;">
                      <% product_lengths.forEach(function(prod){ %>
                          <% if(prod.category == category.slug){ %>
                          <%= prod.length %> items
                          <% } %>
                      <% }) %>
                    </span>
                  </td>
                  <td style="text-align: center;">
                    <a class="btn-modern btn-modern-secondary" href="/admin/categories/edit-category/<%= category._id %>" style="margin-right: 0.5rem;">
                      <i class="fas fa-edit"></i>
                      Edit
                    </a>
                    <% if (category.slug != "shop") { %>
                    <a class="btn-modern btn-modern-danger confirmDeletion" href="/admin/categories/delete-category/<%= category._id %>">
                      <i class="fas fa-trash"></i>
                      Delete
                    </a>
                    <% } %>
                  </td>
              </tr>
              <% }); %>
          </tbody>
        </table>
        <% if(categories.length == 0) { %>
          <div class="empty-state-modern" style="padding: 4rem 2rem; text-align: center;">
            <i class="fas fa-folder-open" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
            <p style="color: #64748b; font-size: 1.1rem; margin: 0;">No categories added yet. Create your first category!</p>
          </div>
        <% } %>
      </div>      
      </div> 
      <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"></script>
      <script>
        $('tbody').sortable({
            items: "tr:not('.home')",
            placeholder: "ui-state-hightlight",
            update: function () {
                var ids = $('tbody').sortable("serialize");
                var url = "/admin/categories/reorder-categories";
                $.post(url, ids);
            }
        });
    
    </script>             

<%- include("../admin/footer") %>